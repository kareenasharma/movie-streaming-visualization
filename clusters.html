<html>
<!DOCTYPE html>
<meta charset="utf-8">
<style>
  
</style>

<body>
  <!-- d3 v6 integration -->
  <script src="https://d3js.org/d3.v6.min.js"></script>
  
  <script>
    let width = 1000,
      height = 700;

    let svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height);

    // call the function that draws
    ready();


    async function ready() {
      // load files async; store the values so we can use them later
        let data = await d3.csv("MoviesOnStreamingPlatforms_updated.csv");

        let root = d3.hierarchy(d3.rollup(data, d => d.length, d => d.Genres.split(",")[0]))
            .sum(([, value]) => value)
            .sort((a, b) => b.value - a.value)

        const pack = () => d3.pack()
            .size([width, height])
            .padding(1)
        (root)

        root = pack(data);

        const genre_list = new Set();
            for (i = 0; i < 16743; i++) {
                let temp = data[i].Genres.split(",")
                for (j = 0; j < temp.length; j++) {
                genre_list.add(temp[j]);
                }
            }
        let genre_array = Array.from(genre_list);

        function col(d) {
            let index = genre_array.indexOf(d.data[0]);
            let scale = d3.scaleLinear().domain([0,27]).range([0,1]);
            return d3.interpolateTurbo(scale(index));
        }

        console.log(root)

        svg.append("g")
            .attr("fill", "ccc")
            .selectAll("circle")
            .data(root.leaves())
            .join("circle")
                .attr("transform", d => `translate(${d.x},${d.y})`)
                .attr("fill", d => col(d))
                .attr("r", d => d.r)
                .append("title")
                    .text(d => d.data[0])
                    .attr("x", function(d) {return d.x;})
                    .attr("y", function(d) {return d.y;})
                    .attr("opacity", .9)
                

                    // .attr("font-size", 14)
                    // .attr("text-anchor", "middle")
                        
                    
                // .text(d => `${d.ancestors().map(d => d.data[0]).reverse().join("/")}\n${format(d.value)}`);

        // svg.append("g")
        //     .attr("pointer-events", "none")
        //     .attr("text-anchor", "middle")
        // .selectAll("text")
        // .data(root.leaves().filter(d => d.r > 2))
        //     .join("text")
        //     .attr("transform", d => `translate(${d.x},${d.y}) scale(${d.r / 30})`)
        // .selectAll("tspan")
        //     .data(d => (d.data[0] + "").split(/\s+/g))
        //     .join("tspan")
        //     .attr("x", 0)
        //     .attr("y", (d, i, nodes) => `${i - nodes.length / 2 + 0.8}em`)
        //     .text(d => d);

        // let group = Array.from(d3.group(data, d => d.Genres.split(",")[0]));
        // console.log(group)
        // // let hierarchy = d3.hierarchy(group);
        
        // let root = pack(data)
        // console.log(root)

        // const node = svg.selectAll("g")
        //     .data(d3.group(root.descendants(), d => d.height))
        //     .join("g")
        //         // .attr("filter", shadow)
        //     .selectAll("g")
        //     .data(d => d[1])
        //     .join("g")
        //         .attr("transform", d => `translate(${d.x + 1},${d.y + 1})`);

        // node.append("circle")
        //     .attr("r", d => d.r)
        //     // .attr("fill", d => color(d.height));
            
        // pack = data => d3.pack()
        //     .size([width - 2, height - 2])
        //     .padding(3)
        //     (d3.hierarchy(group))

    //   function col(d) {
    //     let index = genre_array.indexOf(d.Genres.split(",")[0]);
    //     let scale = d3.scaleLinear().domain([0,27]).range([0,1]);
    //     return d3.interpolateTurbo(scale(index));
    //   }

    //   function pos(d, axis) {
    //     let index = genre_array.indexOf(d.Genres.split(",")[0]);
    //     let scale = d3.scaleLinear().domain([0,27]).range([0, axis]);
    //     return scale(index);
    //   }

    //   var circle = svg.selectAll("circle")
    //   .data(data)
    //   .enter()
    //   .append("circle")
    //     .attr("cx", function(d) { return pos(d, width - 2)  })
    //     .attr("cy",function(d) { return pos(d, height - 2) })
    //     .attr("r", 3)
    //     .style("stroke", "black")
    //     .style("fill", function(d) { return col(d);})
    //     .style("opacity", 0.5)
    //     .on("mouseover", function(d,i){ d3.select(this).attr("r", 50); })
    //     .on("mouseout", function(d,i){ d3.select(this).attr("r", 3); });

      
    }

   

  </script>

</body>
</html>